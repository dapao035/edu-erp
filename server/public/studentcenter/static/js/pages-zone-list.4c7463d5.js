(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-zone-list"],{"278a":function(t,e,n){"use strict";n("a15b"),n("d81d"),n("d3b7"),n("e25e"),n("ac1f"),n("25f0"),n("5319"),n("841c"),n("1276");var i=n("1eb8");function a(t){if("number"!==typeof t||t<0)return t;var e=parseInt(t/3600);t%=3600;var n=parseInt(t/60);t%=60;var i=t;return[e,n,i].map((function(t){return t=t.toString(),t[1]?t:"0"+t})).join(":")}var s={UNITS:{"年":315576e5,"月":26298e5,"天":864e5,"小时":36e5,"分钟":6e4,"秒":1e3},humanize:function(t){var e="";for(var n in this.UNITS)if(t>=this.UNITS[n]){e=Math.floor(t/this.UNITS[n])+n+"前";break}return e||"刚刚"},format:function(t){var e=this.parse(t),n=Date.now()-e.getTime();if(n<this.UNITS["天"])return this.humanize(n);var i=function(t){return t<10?"0"+t:t};return e.getFullYear()+"/"+i(e.getMonth()+1)+"/"+i(e.getDate())+"-"+i(e.getHours())+":"+i(e.getMinutes())},parse:function(t){var e=t.split(/[^0-9]/);return new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5])}};function o(t){return t&&-1==t.search("http")?(i.baseUrl+t).replace("\\","/"):t}t.exports={formatTime:a,dateUtils:s,fixImgUrl:o}},"41a8":function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"content"},[n("v-uni-scroll-view",{staticClass:"bg-white nav",attrs:{"scroll-x":!0}},[n("v-uni-view",{staticClass:"flex text-center"},t._l(t.tabs,(function(e,i){return n("v-uni-view",{key:i,staticClass:"cu-item flex-sub",class:i==t.TabCur?"text-orange cur":"",attrs:{"data-id":i},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.tabSelect.apply(void 0,arguments)}}},[t._v(t._s(t.tabs[i]))])})),1)],1),t._l(t.list,(function(e,i){return 2!=t.TabCur?n("v-uni-view",{key:i,staticClass:"cu-card dynamic no-card margin-bottom-sm"},[n("v-uni-view",{staticClass:"cu-item shadow"},[n("v-uni-view",{staticClass:"cu-list menu-avatar"},[n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"cu-avatar round",style:{"background-image":"url("+e.student_avatar+")"}}),n("v-uni-view",{staticClass:"content flex-sub flex justify-between"},[n("v-uni-view",[t._v(t._s(e.student_name))]),n("v-uni-view",{staticClass:"text-gray text-xs "},[t._v(t._s(e.add_time))])],1)],1)],1),e.content?n("v-uni-view",{staticClass:"text-content margin-top-sm"},[t._v(t._s(e.content))]):t._e(),1!=e.type?n("v-uni-view",{staticClass:"grid flex-sub padding-lr col-3 grid-square"},[t._l(e.attach,(function(i,a){return 3==e.type?n("v-uni-view",{key:a,staticClass:"bg-img",style:{backgroundImage:"url("+t.fixImgUrlFunc(i)+")"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.previewImg(e.attach,a)}}}):t._e()})),2==e.type?n("v-uni-view",{staticClass:"bg-gray",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.playAudio(e)}}},[e.playing?n("v-uni-text",{staticClass:"cuIcon-stop margin-lr-xs"}):n("v-uni-text",{staticClass:"cuIcon-playfill margin-lr-xs"})],1):t._e()],2):t._e(),n("v-uni-view",{staticClass:"text-gray text-right padding"},[n("v-uni-view",{staticClass:"inline-block",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.handleLike(e.id,i)}}},[n("v-uni-text",{staticClass:"cuIcon-appreciatefill margin-lr-xs"}),t._v(t._s(e.likes_count))],1),n("v-uni-view",{staticClass:"inline-block margin-left",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.handleComment(e.id,i)}}},[n("v-uni-text",{staticClass:"cuIcon-messagefill margin-lr-xs"}),t._v(t._s(e.comments.length))],1)],1),e.verify_content?n("v-uni-view",{staticClass:"cu-list menu-avatar comment solids-top"},[n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"cu-avatar round",style:{"background-image":"url("+t.fixImgUrlFunc(e.verifier_photo)+")"}}),n("v-uni-view",{staticClass:"content"},[n("v-uni-view",{staticClass:"text-grey flex justify-between "},[n("v-uni-view",{staticClass:"text-sm"},[t._v(t._s(e.verifier_name)+" 点评:")]),n("v-uni-view",{staticClass:"text-xs "},[t._v(t._s(e.add_time))])],1),n("v-uni-view",{staticClass:"radius margin-top-sm"},[n("v-uni-view",{staticClass:"flex"},[n("v-uni-view",{staticClass:"flex-sub"},[t._v(t._s(e.verify_content))]),n("v-uni-view",{staticClass:"margin-left text-lg text-orange"},[t._v(t._s(e.verify_score)+"分")])],1)],1)],1)],1)],1):t._e(),n("v-uni-view",{staticClass:"padding-lr padding-bottom-sm "},t._l(e.comments,(function(e,a){return n("v-uni-view",{key:a,staticClass:"bg-gray padding-xs radius margin-top-sm"},[n("v-uni-text",{staticClass:"text-sm"},[t._v(t._s(e.publisher?e.publisher.name:"评论人")+"："+t._s(e.content))]),1==e.is_my?n("v-uni-text",{staticClass:"text-sm margin-left text-blue",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.handleDelComment(e.id,i)}}},[t._v("删除")]):t._e()],1)})),1)],1),0==t.list.length?n("v-uni-view",{staticClass:"text-center padding text-gray"},[t._v("暂无记录")]):t._e()],1):t._e()})),2==t.TabCur?n("v-uni-view",{staticClass:"cu-list menu sm-border",staticStyle:{"padding-bottom":"200upx"}},[t._l(t.taskList,(function(e,i){return n("v-uni-view",{key:i,staticClass:"cu-item ",class:{arrow:0==e.is_finish}},[n("v-uni-view",{staticClass:"content padding-sm"},[n("v-uni-view",{staticClass:"text-black text-df"},[t._v(t._s(i+1)+"、"+t._s(e.content))])],1),n("v-uni-view",{staticClass:"action text-right"},[0==e.is_finish?n("v-uni-view",{staticClass:"text-orange",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.toFinish(e.id)}}},[t._v("去完成")]):n("v-uni-view",{staticClass:"text-gray"},[t._v("已完成")])],1)],1)})),0==t.taskList.length?n("v-uni-view",{staticClass:"text-center padding text-gray"},[t._v("暂无记录")]):t._e()],2):t._e(),n("v-uni-view",{staticClass:"cu-modal",class:t.showCommentModal?"show":""},[n("v-uni-view",{staticClass:"cu-dialog"},[n("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[n("v-uni-view",{staticClass:"content"},[t._v("发布评论")]),n("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showCommentModal=!1}}},[n("v-uni-text",{staticClass:"cuIcon-close text-red"})],1)],1),n("v-uni-view",{},[n("v-uni-view",{staticClass:"cu-form-group"},[n("v-uni-textarea",{staticClass:"text-left",staticStyle:{height:"300upx"},attrs:{maxlength:"-1",value:t.commentContent,placeholder:"请输入评论..."},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.textareaInput.apply(void 0,arguments)}}})],1)],1),n("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[n("v-uni-view",{staticClass:"action"},[n("v-uni-button",{staticClass:"cu-btn line-green text-green",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showCommentModal=!1}}},[t._v("取消")]),n("v-uni-button",{staticClass:"cu-btn bg-green margin-left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.publishComment.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],1)],2)},s=[]},ba52:function(t,e,n){"use strict";n.r(e);var i=n("41a8"),a=n("ba5b");for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);var o,u=n("f0c5"),c=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"639d5b1d",null,!1,i["a"],o);e["default"]=c.exports},ba5b:function(t,e,n){"use strict";n.r(e);var i=n("ea48"),a=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=a.a},bb17:function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("eee5")),s={data:function(){return{pageData:{page:1,lastPage:1}}},onReachBottom:function(){this.handleReachBottom()},methods:{foo:function(){console.log("foo")},handleReachBottom:function(){this.pageData.lastPage!=this.pageData.page&&(this.pageData.lastPage>this.pageData.page?(this.pageData.page++,this.handleReq()):a.default.showError("没有更多数据"))}}};e.default=s},ea48:function(t,e,n){"use strict";var i=n("dbce"),a=n("4ea4");n("99af"),n("e25e"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=a(n("b85c")),o=n("278a"),u=i(n("eee5")),c=i(n("e7f9")),l=a(n("bb17")),r={mixins:[l.default],components:{},data:function(){return{tabs:["班级发布","我的发布"],TabCur:0,list:[],taskList:[],clazzId:"",isMine:0,audioContext:null,showCommentModal:!1,commentContent:"",commentId:0,commentIndex:0}},onLoad:function(){this.handleReq()},onShow:function(){},methods:{textareaInput:function(t){this.commentContent=t.detail.value},handleReq:function(){var t=this;c.get("student/zoneList",{page:this.pageData.page,mine:this.isMine},(function(e){"success"==e.result?(t.list=t.list.concat(e.data.data),t.pageData.page=parseInt(e.data.current_page),t.pageData.lastPage=parseInt(e.data.last_page)):u.showError(e.msg)}))},handleReqTasks:function(){var t=this;c.get("student/taskList",{page:this.pageData.page},(function(e){"success"==e.result?(t.taskList=t.taskList.concat(e.data.data),t.pageData.page=parseInt(e.data.current_page),t.pageData.lastPage=parseInt(e.data.last_page)):u.showError(e.msg)}))},toFinish:function(t){uni.navigateTo({url:"/pages/zone/publish?id="+t,animationDuration:200})},handleLike:function(t,e){var n=this;c.get("student/zoneLike",{id:t},(function(t){u.showError(t.msg),n.list[e].likes_count=t.data.count}))},handleComment:function(t,e){this.commentContent="",this.commentIndex=e,this.showCommentModal=!0,this.commentId=t},handleDelComment:function(t,e){var n=this;c.post("student/zoneCommentDel",{id:t},(function(t){u.showError(t.msg),n.list[e].comments=t.data.list}))},publishComment:function(){var t=this;c.post("student/zoneComment",{id:this.commentId,content:this.commentContent},(function(e){u.showError(e.msg),t.list[t.commentIndex].comments=e.data.list,t.showCommentModal=!1}))},fixImgUrlFunc:function(t){return(0,o.fixImgUrl)(t)},playAudio:function(t){var e,n=t.playing,i=(0,s.default)(this.list);try{for(i.s();!(e=i.n()).done;){var a=e.value;2==a.type&&this.$set(a,"playing",!1)}}catch(o){i.e(o)}finally{i.f()}if(1==n)return this.$set(t,"playing",!1),void this.audioContext.stop();this.$set(t,"playing",!0),this.audioContext&&this.audioContext.stop(),this.audioContext=uni.createInnerAudioContext(),this.audioContext.src=t.attach,this.audioContext.autoplay=!0,this.audioContext.onPlay((function(){console.log("开始播放")})),this.audioContext.onError((function(t){console.log(t.errMsg),console.log(t.errCode)}))},previewImg:function(t,e){var n,i=[],a=(0,s.default)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.push(this.fixImgUrlFunc(o))}}catch(u){a.e(u)}finally{a.f()}uni.previewImage({urls:i,current:i[e],longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})},tabSelect:function(t){this.TabCur=t.currentTarget.dataset.id,this.list=[],this.pageData.page=1,0==this.TabCur&&(this.list=[],this.isMine=0,this.handleReq()),1==this.TabCur&&(this.list=[],this.isMine=1,this.handleReq()),2==this.TabCur&&(this.taskList=[],this.handleReqTasks())}}};e.default=r}}]);