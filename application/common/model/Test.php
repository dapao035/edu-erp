<?phpnamespace app\common\model;use think\Db;use think\model\concern\SoftDelete;class Test extends BaseModel{    use SoftDelete;    protected $table = 'test';    protected $deleteTime = 'delete_time';    function part()    {        return $this->hasMany(TestPart::class, 'test_id')->order('sort_num');    }    function question()    {        return $this->belongsToMany(Question::class, 'test_question', 'question_id', 'test_id')->order('sort_num');    }    function knowledge()    {        return $this->belongsToMany(Knowledge::class, 'knowledge_test', 'knowledge_id', 'test_id');    }    function section()    {        return $this->belongsToMany(Section::class, 'section_test', 'section_id', 'test_id');    }    static function getQuestionList($test_id)    {        $list = TestQuestion::where(compact('test_id'))->select()->toArray();        $part_list = $group_list = $question_ids = [];        foreach ($list as $v1) {            $part_list[$v1['part_id']][] = $v1['group_id'];            $group_list[$v1['group_id']][] = $v1['question_id'];            $question_ids[] = $v1['question_id'];        }//        echo '部分';//        dump($part_list);//        echo '组';//        dump($group_list);//        echo '试题';//        dump($question_ids);//        die;        foreach ($part_list as &$v2) {            $v2 = array_unique($v2);        }        $parts = TestPart::where('id', 'in', array_keys($part_list))->column('content','id');        $groups = QuestionGroup::where('id', 'in', array_keys($group_list))->column('body','id');        $questions = Question::with('opt')->where('id', 'in', $question_ids)->select()->toArray();        $q_list = [];        foreach ($questions as $q) {            $q_list[$q['id']] = $q;        }        $res = [];        foreach ($part_list as $pid => $gids) {            $res[$pid]['part'] = $parts[$pid];            foreach ($group_list as $gid => $qids) {                if(in_array($gid, $gids)) {                    $qs = [];                    foreach ($qids as $qid) {                        $qs[] = $q_list[$qid];                    }                    $res[$pid]['group'][] = [                        'group_body' => isset($groups[$gid])?$groups[$gid]: '',                        'question' => $qs                    ];                }            }        }        return $res;    }}