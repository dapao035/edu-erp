(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6803ecaf"],{"096f":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("cui-search",{attrs:{config:e.searchConfig},on:{handleRequest:e.handleRequest}}),i("cui-table",{ref:"tableBuilder",attrs:{config:e.tableConfig,selectedRows:e.selectedRows},on:{"update:selectedRows":function(t){e.selectedRows=t},"update:selected-rows":function(t){e.selectedRows=t}}}),i("cui-dialog-form",{ref:"cuiDialogForm",attrs:{title:e.formTitle,formConfig:e.formConfig,visible:e.formVisible},on:{"update:visible":function(t){e.formVisible=t},onSubmit:e.onSubmit}}),i("DataPermissionList",{ref:"dataPermissionList",attrs:{visible:e.dpVisible,id:e.targetId,positionName:e.targetName},on:{"update:visible":function(t){e.dpVisible=t}}})],1)},r=[],a=i("1da1"),o=(i("96cf"),i("b0c0"),i("d282")),s=i("ed08"),c=i("6e6f"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("cui-dialog",{attrs:{title:e.title,visible:e.dialogVisible,showSubmitBtn:!1,width:"880px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("cui-table",{ref:"tableBuilder",attrs:{config:e.tableConfig,selectedRows:e.selectedRows},on:{"update:selectedRows":function(t){e.selectedRows=t},"update:selected-rows":function(t){e.selectedRows=t}}}),i("DataPermissionSave",{ref:"dataPermissionSave",attrs:{visible:e.formVisible,id:e.targetId},on:{"update:visible":function(t){e.formVisible=t},onSubmit:function(t){return e.$refs.tableBuilder.loadData()}}})],1)},u=[],f=i("b85c"),d=(i("a9e3"),i("a15b"),i("b775"));function m(e){return p.apply(this,arguments)}function p(){return p=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d["a"])({url:"/common/dataPermission/save",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return h=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d["a"])({url:"/common/dataPermission/delete",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}var g=i("2934"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("cui-dialog",{attrs:{title:"设置岗位的数据查看权限",visible:e.dialogVisible,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t},submit:e.formSubmit}},[i("div",{staticClass:"detail-box",staticStyle:{"margin-top":"30px"}},[i("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,"label-width":"160px",size:"mini"}},[i("el-form-item",{attrs:{label:"数据名称",prop:"info"}},[i("el-input",{model:{value:e.formData.info,callback:function(t){e.$set(e.formData,"info",t)},expression:"formData.info"}})],1),i("el-form-item",{attrs:{label:"数据实体表",prop:"entityName"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.formData.entityName,callback:function(t){e.$set(e.formData,"entityName",t)},expression:"formData.entityName"}},e._l(e.dataList,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1),i("el-form-item",{attrs:{label:"数据负责人字段名",prop:"ownerField"}},[i("el-input",{model:{value:e.formData.ownerField,callback:function(t){e.$set(e.formData,"ownerField",t)},expression:"formData.ownerField"}}),i("small",[e._v("留空表示按默认")])],1),i("el-form-item",{attrs:{label:"权限范围类型:",prop:"scopeType"}},[i("cui-radio-enum",{attrs:{code:"DataScopeTypeEnum",value:e.formData.scopeType},on:{"update:value":function(t){return e.$set(e.formData,"scopeType",t)}}})],1),"自定义"==e.formData.scopeType?i("el-form-item",{attrs:{label:"选择自定义机构:",required:""}},[i("cui-select-box",{attrs:{code:"org",value:e.formData.orgIds,visible:e.orgSelector},on:{"update:value":function(t){return e.$set(e.formData,"orgIds",t)},"update:visible":function(t){e.orgSelector=t}}})],1):e._e()],1)],1)])},w=[],D=(i("ac1f"),i("1276"),i("cf45")),y={id:null,positionId:"",entityName:"",ownerField:"",scopeType:"全部",orgIds:"",info:""},R={name:"DataPermissionSave",components:{},props:{visible:{type:Boolean,required:!0},id:[String,Number]},data:function(){return{dataList:{},formData:{},orgSelector:!1,rules:{entityName:[{required:!0,message:"请输入实体表名"}],scopeType:[{required:!0,message:"请选择权限范围类型"}],info:[{required:!0,message:"请输入数据名称"}]}}},computed:{dialogVisible:{get:function(){return!!this.visible},set:function(e){this.$emit("update:visible",e)}}},created:function(){this.dataList=Object(D["c"])("DataScopeEntities")},methods:{formSubmit:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=Object.assign({},this.formData),t.orgIds=""==t.orgIds?[]:t.orgIds.split(","),t.positionId=this.id,e.next=5,m(t);case 5:i=e.sent,Object(s["a"])(i)&&(this.$emit("update:visible",!1),this.$emit("onSubmit"),this.initData(),Object(D["e"])(i.msg,"success"));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),initData:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:"undefined"==typeof t&&(t=y),this.formData=Object.assign({},t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},j=R,O=i("2877"),S=Object(O["a"])(j,v,w,!1,null,"6c015067",null),x=S.exports,$={name:"DataPermissionList",components:{DataPermissionSave:x},props:{visible:{type:Boolean,required:!0},id:[String,Number],positionName:[String]},data:function(){var e=this;return{tableConfig:{info:"数据权限是通过对实体表的范围查询来控制的；负责人字段里存放的是员工的ID，该字段名要和数据库里的一致；未定义的实体表默认不参与数据权限控制；范围类型依托组织结构的层级关系。",url:o["a"].dataPermissionList,selectable:!0,autoLoad:!1,condition:{},fields:[{title:"数据名称",name:"info"},{title:"数据范围类型",name:"scopeType"},{title:"数据实体表",name:"entityName"},{title:"数据负责人字段名",name:"ownerField"}],actions:[{title:"编辑",click:function(t){e.targetId=e.id,e.formVisible=!0;var i,n=[],r=Object(f["a"])(t.customList);try{for(r.s();!(i=r.n()).done;){var a=i.value;n.push(a.orgId)}}catch(o){r.e(o)}finally{r.f()}t.orgIds=n.join(","),e.$refs.dataPermissionSave.initData(t)}}],topActions:[{title:"新增",type:"primary",icon:"el-icon-plus",click:function(){e.targetId=e.id,e.formVisible=!0,e.$refs.dataPermissionSave.initData()}},{title:"删除",icon:"el-icon-delete",click:function(){Object(g["d"])(b,e.selectedRows,(function(){return e.$refs.tableBuilder.loadData()}))}}],showDiyButtons:!1},selectedRows:[],formVisible:!1,targetId:""}},computed:{dialogVisible:{get:function(){var e=this;return this.visible&&this.$nextTick((function(){e.tableConfig.condition={positionId:e.id},e.$refs.tableBuilder.loadData()})),!!this.visible},set:function(e){this.$emit("update:visible",e)}},title:function(){return"["+this.positionName+"]岗位的数据权限列表"}},mounted:function(){},methods:{onSubmit:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:i=e.sent,Object(s["a"])(i)&&(this.$refs.cuiDialogForm.onReset(),this.$refs.tableBuilder.loadData());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},k=$,I=Object(O["a"])(k,l,u,!1,null,null,null),V=I.exports,N={name:"positionList",components:{DataPermissionList:V},data:function(){var e=this;return{infoDialog:!1,itemId:"",formTitle:"",tableConfig:{url:o["a"].positionList,selectable:!0,condition:{},fields:[{title:"职位名称",name:"name"}],actionWidth:140,actions:[{title:"编辑",click:function(t){e.formTitle="修改职位信息",e.formVisible=!0,e.$refs.cuiDialogForm.initFormData(t)}},{title:"数据权限",click:function(t){e.targetId=t.id,e.targetName=t.name,e.dpVisible=!0}}],topActions:[{title:"新增",type:"primary",icon:"el-icon-plus",click:function(){e.formTitle="新增职位",e.formVisible=!0,e.$refs.cuiDialogForm.onReset()}},{title:"删除",icon:"el-icon-delete",click:function(){Object(g["d"])(c["a"],e.selectedRows,(function(){return e.handleRequest()}))}}]},selectedRows:[],searchConfig:{fields:[{label:"搜名称",name:"name",type:"input"}]},formConfig:{fields:[{label:"职位名称",name:"name",type:"input"}],rules:{name:[{required:!0,message:"请输入名称"}]}},formVisible:!1,dpVisible:!1,targetId:"",targetName:""}},methods:{handleRequest:function(e){e&&Object.assign(this.tableConfig.condition,e),this.$refs.tableBuilder.loadData()},onSubmit:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["b"])(t);case 2:i=e.sent,Object(s["a"])(i)&&(this.$refs.cuiDialogForm.onReset(),this.$refs.tableBuilder.loadData());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},P=N,C=Object(O["a"])(P,n,r,!1,null,null,null);t["default"]=C.exports},"6e6f":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return s})),i.d(t,"c",(function(){return l}));var n=i("1da1"),r=(i("96cf"),i("b775"));i("d282");function a(e){return o.apply(this,arguments)}function o(){return o=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r["a"])({url:"/common/position/save",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function s(e){return c.apply(this,arguments)}function c(){return c=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r["a"])({url:"/common/position/delete",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return u=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r["a"])({url:"/common/position/setStaffPosition",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}}}]);