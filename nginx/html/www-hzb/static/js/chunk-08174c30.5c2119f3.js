(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08174c30"],{"086b":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("cui-search",{attrs:{config:e.searchConfig},on:{handleRequest:e.handleRequest}}),n("cui-table",{ref:"tableBuilder",attrs:{config:e.tableConfig,selectedRows:e.selectedRows},on:{"update:selectedRows":function(t){e.selectedRows=t},"update:selected-rows":function(t){e.selectedRows=t}}}),n("ScheduleDialog",{ref:"schedule",attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},onSubmit:function(t){return e.$refs.tableBuilder.loadData()}}}),n("ConflictList",{ref:"conflictList",attrs:{visible:e.conflictListVisible,ids:e.conflictIds},on:{"update:visible":function(t){e.conflictListVisible=t}}})],1)},i=[],a=(n("ac1f"),n("1276"),n("a15b"),n("d282")),s=n("a49b"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("cui-dialog",{attrs:{title:e.formData.id?"修改排课计划":"添加排课计划",visible:e.dialogVisible,width:"700px"},on:{"update:visible":function(t){e.dialogVisible=t},submit:e.formSubmit}},[n("cui-form",{ref:"formRef",attrs:{config:e.formConfig},on:{update:e.formUpdate}}),n("LessonTimes",{attrs:{value:e.lessonSetting},on:{"update:value":function(t){e.lessonSetting=t}}})],1)},c=[],u=n("b85c"),l=n("1da1"),d=(n("96cf"),n("d81d"),n("cf45")),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{"margin-bottom":"10px"}},[n("div",{staticStyle:{float:"right"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("添加")])],1),n("span",{staticStyle:{"line-height":"25px"}},[e._v("上课时间: ")])]),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.lessonTimes}},[n("el-table-column",{attrs:{prop:"weeks",label:"星期",width:"190px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-select",{attrs:{multiple:"",placeholder:"请选择",size:"small"},model:{value:t.row.weeks,callback:function(n){e.$set(t.row,"weeks",n)},expression:"scope.row.weeks"}},e._l(e.weekDays,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),n("el-table-column",{attrs:{prop:"startTime",label:"开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-time-select",{staticStyle:{width:"110px"},attrs:{"picker-options":{start:"06:00",step:"00:10",end:"22:30"},size:"small"},model:{value:t.row.startTime,callback:function(n){e.$set(t.row,"startTime",n)},expression:"scope.row.startTime"}})]}}])}),n("el-table-column",{attrs:{prop:"endTime",label:"结束时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-time-select",{staticStyle:{width:"110px"},attrs:{"picker-options":{start:"06:00",step:"00:10",end:"22:30",minTime:t.row.startTime},size:"small"},model:{value:t.row.endTime,callback:function(n){e.$set(t.row,"endTime",n)},expression:"scope.row.endTime"}})]}}])}),n("el-table-column",{attrs:{prop:"roomId",label:"教室",width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("cui-select-box",{attrs:{code:"classroom",value:t.row.roomId,limit:1},on:{"update:value":function(n){return e.$set(t.row,"roomId",n)}}})]}}])}),n("el-table-column",{attrs:{align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleRemove(t.$index)}}},[e._v("移除")])]}}])})],1)],1)},f=[],m=(n("a434"),n("4c6b")),h={name:"LessonTimes",props:{value:{require:!0}},data:function(){return{weekDays:m["c"]}},computed:{lessonTimes:{get:function(){return this.value&&this.value.length>0?this.value:[{weeks:[],startTime:"",endTime:"",roomId:""}]},set:function(e){this.$emit("update:value",e)}}},watch:{lessonTimes:{handler:function(e){this.$emit("update:value",e)},deep:!0}},methods:{handleAdd:function(){this.lessonTimes.push({weeks:[],startTime:"",endTime:"",roomId:""})},handleRemove:function(e){this.lessonTimes.splice(e,1)},initData:function(){}}},b=h,w=n("2877"),g=Object(w["a"])(b,p,f,!1,null,null,null),j=g.exports,O=n("8897"),v=n("ed08"),y=n("61f7"),k={id:"",classId:"",courseId:"",teacherIds:"",assistantIds:"",startDate:"",endDate:"",times:"",decLessonCount:1},R={name:"LessonScheduleDialog",components:{LessonTimes:j},props:{visible:{type:Boolean,required:!0}},data:function(){return{lessonSetting:[{weeks:[],startTime:"",endTime:"",roomId:""}],formConfig:{fields:[{label:"选择班级",name:"classId",type:"selectBox",code:"class",limit:1},{label:"上课老师",name:"teacherIds",type:"selectBox",code:"teacher"},{label:"助教老师",name:"assistantIds",type:"selectBox",code:"teacher"},{label:"开始日期",name:"startDate",type:"date"},{label:"结束日期",name:"endDate",type:"date"},{label:"最多排课次数",name:"times",type:"number",placeholder:"不填按日期排满"},{label:"消课次数",name:"decLessonCount",type:"number"},{label:"跳过节假日",name:"excludeHoliday",type:"switch",info:"节假日到节假日管理里设置."}],rules:{classId:[{required:!0,message:"请选择班级",trigger:"change"}],teacherIds:[{required:!0,message:"请选择上课老师",trigger:"change"}],startDate:[{required:!0,message:"请选择开始日期"}],endDate:[{required:!0,message:"请选择结束日期"}]},labelWidth:"120px"},formData:Object.assign({},k)}},computed:{dialogVisible:{get:function(){return!!this.visible},set:function(e){this.$emit("update:visible",e)}}},created:function(){},methods:{formUpdate:function(e){this.formData=e},formSubmit:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=this.checkLessonTimes()){e.next=2;break}return e.abrupt("return");case 2:return t=Object.assign({},this.formData),console.log(this.formData),t.teacherIds=t.teacherIds?t.teacherIds.split(","):[],t.assistantIds=t.assistantIds?t.assistantIds.split(","):[],t.setting=this.lessonSetting,e.next=9,Object(O["o"])(t);case 9:n=e.sent,Object(v["a"])(n)&&(this.$emit("update:visible",!1),this.$emit("onSubmit"),this.initData(),Object(d["e"])(n.msg,"success"));case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),checkLessonTimes:function(){if(0==this.lessonSetting.length)return Object(d["e"])("未设置上课时间","error"),!1;var e,t=Object(u["a"])(this.lessonSetting);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(0==n.weeks.length)return Object(d["e"])("星期设置有误","error"),!1;if(""==n.startTime)return Object(d["e"])("上课开始时间设置有误","error"),!1;if(""==n.endTime)return Object(d["e"])("上课开始时间设置有误","error"),!1}}catch(r){t.e(r)}finally{t.f()}return!0},initData:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n,r,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("undefined"==typeof t&&(t=k),setTimeout((function(){i.$refs.formRef.setInitData(t)}),50),!t.id){e.next=8;break}return e.next=5,Object(O["g"])(t.id);case 5:if(n=e.sent,Object(y["a"])(n)&&n.length>0)for(r in n)n[r].weeks=n[r].weeks.split(",").map((function(e){return parseInt(e)}));this.lessonSetting=n;case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},x=R,S=Object(w["a"])(x,o,c,!1,null,null,null),T=S.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("cui-dialog",{attrs:{title:"冲突课次列表",visible:e.dialogVisible,showSubmitBtn:!1,width:"700px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("cui-table",{ref:"tableBuilder",attrs:{config:e.tableConfig}})],1)},D=[],C={name:"ConflictList",components:{},props:{visible:{type:Boolean,required:!0},ids:{type:String,required:!0}},data:function(){var e=this.$createElement;return{tableConfig:{url:a["a"].lessonList,indexed:!0,height:500,autoLoad:!1,condition:{},fields:[{title:"班级名称",name:"className"},{title:"课程名称",name:"courseName"},{title:"上课日期",content:function(t){return e("span",[t.date," (",t.week,")"])}},{title:"开始时间",name:"startTime"},{title:"结束时间",name:"endTime"},{title:"上课老师",name:"teacherNames"}],showDiyButtons:!1}}},watch:{ids:function(e){console.log("ids",e),this.tableConfig.condition={ids:e},this.loadData()}},computed:{dialogVisible:{get:function(){return!!this.visible},set:function(e){this.$emit("update:visible",e)}}},created:function(){},methods:{loadData:function(){var e=this;setTimeout((function(){e.$refs.tableBuilder.loadData()}),30)}}},L=C,$=Object(w["a"])(L,I,D,!1,null,null,null),B=$.exports,q={name:"LessonSchedule",components:{ScheduleDialog:T,ConflictList:B},props:{},data:function(){var e=this,t=this.$createElement;return{conflictListVisible:!1,conflictIds:"",dialogVisible:!1,tableConfig:{url:a["a"].lessonScheduleList,selectable:!0,condition:{},fields:[{title:"课表生成",content:function(e){return t("span",[e.state?"已生成":"未生成"])},width:80},{title:"冲突",content:function(n){var r="";if(null===n.conflictIds)return t("span",["未检查"]);var i=n.conflictIds.split(","),a=i.length;if(1==a&&""===i[0])return t("span",["无冲突"]);r=a+"个冲突";return t("span",{class:"text-link text-warning",on:{click:function(){e.showConflict(n.conflictIds)}}},[r])}},{title:"班级名称",name:"className"},{title:"所属课程",name:"courseName"},{title:"上课老师",name:"teacherNames"},{title:"助教",name:"assistantNames"},{title:"开始日期",name:"startDate"},{title:"结束日期",name:"endDate"},{title:"上课时间",width:"150px",content:function(e){return t("span",{style:{whiteSpace:"pre-wrap"}},[e.lessonTimesInfo.join(",\n")])}},{title:"计划课次",width:"65px",name:"times"},{title:"已生成课次",width:"80px",name:"lessonCount"},{title:"消课数",width:"60px",name:"decLessonCount"},{title:"不含节日",width:"65px",content:function(e){return t("span",[e.excludeHoliday?"是":"否"])}}],actions:[{title:"编辑",visible:function(e){return!e.state},click:function(t){e.$refs.schedule.initData(t),e.dialogVisible=!0}}],topActions:[{title:"新增计划",icon:"el-icon-plus",type:"primary",click:function(){e.$refs.schedule.initData(),e.dialogVisible=!0}},{title:"批量生成课表",icon:"el-icon-date",type:"primary",click:function(){s["a"].handleGenerate(e.selectedRows,(function(t){Object(d["e"])(t.msg),e.handleRequest()}))}},{title:"冲突检查",icon:"el-icon-document-checked",click:function(){s["a"].handleConflict(e.selectedRows,(function(t){Object(d["e"])(t.msg),e.handleRequest()}))}},{title:"删除计划",icon:"el-icon-delete",click:function(){s["a"].handleDelete(e.selectedRows,(function(t){Object(d["e"])(t.msg),e.handleRequest()}))}},{title:"删除已生成课表",icon:"el-icon-delete",click:function(){s["a"].deleteLessonBySchedule(e.selectedRows,(function(t){Object(d["e"])(t.msg),e.handleRequest()}))}}],rowClassName:function(e){var t=e.row;return t.state?"success-row":""}},selectedRows:[],searchConfig:{fields:[{label:"课程名称",name:"name",type:"input"},{label:"科目",name:"subjectId",type:"select",code:"subject"},{label:"状态",name:"state",type:"enumCheckbox",code:"SwitchEnum",width:240}]}}},created:function(){},methods:{handleRequest:function(e){e&&Object.assign(this.tableConfig.condition,e),this.$refs.tableBuilder.loadData()},showConflict:function(e){this.conflictIds=e,this.conflictListVisible=!0}}},_=q,V=Object(w["a"])(_,r,i,!1,null,null,null);t["default"]=V.exports},8897:function(e,t,n){"use strict";n.d(t,"o",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"k",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"g",(function(){return h})),n.d(t,"c",(function(){return w})),n.d(t,"f",(function(){return j})),n.d(t,"h",(function(){return v})),n.d(t,"m",(function(){return k})),n.d(t,"p",(function(){return x})),n.d(t,"b",(function(){return T})),n.d(t,"r",(function(){return D})),n.d(t,"j",(function(){return L})),n.d(t,"l",(function(){return B})),n.d(t,"n",(function(){return _})),n.d(t,"i",(function(){return E})),n.d(t,"q",(function(){return G}));var r=n("1da1"),i=(n("96cf"),n("b775"));n("d282");function a(e){return s.apply(this,arguments)}function s(){return s=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonSchedule/saveSchedule",method:"POST",data:t}));case 1:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function o(e){return c.apply(this,arguments)}function c(){return c=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonSchedule/generateLesson",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function u(e){return l.apply(this,arguments)}function l(){return l=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonStudent/rollbackCourseNum",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return p=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonSchedule/delete",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return m=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonSchedule/checkConflict",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return b=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonSchedule/lessonTimes",method:"GET",params:{id:t}}));case 1:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function w(e){return g.apply(this,arguments)}function g(){return g=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/deleteBySchedule",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function j(e){return O.apply(this,arguments)}function O(){return O=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/info",method:"GET",params:{id:t}}));case 1:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return y=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/calendar",method:"GET",params:t}));case 1:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function k(e){return R.apply(this,arguments)}function R(){return R=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/save",method:"POST",data:t}));case 1:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function x(e){return S.apply(this,arguments)}function S(){return S=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/saveQuick",method:"POST",data:t}));case 1:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function T(e){return I.apply(this,arguments)}function I(){return I=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/delete",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function D(e){return C.apply(this,arguments)}function C(){return C=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/stop",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}function L(e){return $.apply(this,arguments)}function $(){return $=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/reopen",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function B(e){return q.apply(this,arguments)}function q(){return q=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/rollCallBatch",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),q.apply(this,arguments)}function _(e){return V.apply(this,arguments)}function V(){return V=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lessonStudent/evaluation",method:"POST",data:t}));case 1:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function E(e){return N.apply(this,arguments)}function N(){return N=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/openBooking",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function G(e){return z.apply(this,arguments)}function z(){return z=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["a"])({url:"/common/lesson/stopBooking",method:"post",data:t}));case 1:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}},a49b:function(e,t,n){"use strict";var r=n("1da1"),i=n("b85c"),a=(n("96cf"),n("cf45")),s=n("2934"),o=n("8897"),c=n("ed08");t["a"]={handleConflict:function(e,t){Object(a["a"])(e,"请先选择计划")&&Object(s["c"])("确认进行冲突检查?",o["a"],e,(function(e){Object(c["a"])(e)&&Object(a["e"])("无冲突"),t()}))},handleGenerate:function(e,t){Object(a["a"])(e,"请先选择计划")&&Object(s["c"])("确认生成课表?",o["e"],e,t)},handleDelete:function(e,t){Object(a["a"])(e,"请先选择计划")&&Object(s["c"])("确认删除?",o["d"],e,t)},deleteLessonBySchedule:function(e,t){Object(a["a"])(e,"请先选择计划")&&Object(s["c"])("确认永久删除该排课计划生成的课表?",o["c"],e,t)},deleteLesson:function(e,t){Object(a["a"])(e,"请先选择")&&Object(s["c"])("确认删除?",o["b"],e,t)},stopLesson:function(e,t){Object(a["a"])(e,"请先选择")&&Object(s["c"])("确认停课?",o["r"],e,t)},reopenLesson:function(e,t){Object(a["a"])(e,"请先选择")&&Object(s["c"])("确认恢复上课?",o["j"],e,t)},rollbackCourseNum:function(e,t){Object(a["a"])(e,"请先选择")&&Object(s["c"])("确认返还?",o["k"],e,t)},rollCall:function(e,t,n,s){if(Object(a["a"])(n,"请先选择")){var u="",l=Object(a["c"])("SignStateEnum");for(var d in l)if(t==d){u="确认设为"+l[d]+"?";break}if(""!=u){var p=Object(a["d"])(n,"studentId");if(0!=p.length){var f,m=[],h=Object(i["a"])(p);try{for(h.s();!(f=h.n()).done;){var b=f.value;m.push({studentId:b,lessonId:e,state:t})}}catch(w){h.e(w)}finally{h.f()}Object(a["b"])(u,Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["l"])(m);case 2:t=e.sent,Object(c["a"])(t)&&(Object(a["e"])("点名成功"),s());case 4:case"end":return e.stop()}}),e)}))))}else Object(a["e"])("未选择学员","error")}else Object(a["e"])("状态参数错误","error")}},handleOpenBooking:function(e,t){Object(a["a"])(e,"请先选择")&&Object(s["c"])("确认开启预约?",o["i"],e,t)},handleStopBooking:function(e,t){Object(a["a"])(e,"请先选择")&&Object(s["c"])("确认关闭预约?",o["q"],e,t)}}}}]);